<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Keilani • Voice Chat</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- CSS (cache-busted) -->
    <link rel="stylesheet" href="/styles.css?v=16" />
  </head>
  <body>
    <header class="topbar">
      <div class="brand">Keilani • Voice Chat</div>
      <div class="status-pill">
        <span id="hudState" aria-live="polite">state: idle</span>
        <span id="hudLatency" class="muted"></span>
        <span id="hudLast" class="muted"></span>
      </div>
    </header>

    <main class="wrap">
      <section class="controls">
        <div class="row">
          <!-- New IDs -->
          <button id="startBtn" class="btn primary">▶ Start chat</button>
          <button id="stopBtn" class="btn">‖ Stop</button>
          <button id="pttBtn" class="btn">🎙 Hold to talk</button>
          <label class="chk"
            ><input id="autoChk" type="checkbox" /> Auto talk</label
          >

          <!-- Legacy IDs (left hidden; keep if your old HTML is still cached) -->
          <button id="start" style="display: none"></button>
          <button id="stop" style="display: none"></button>
          <button id="ptt" style="display: none"></button>
          <input id="auto" type="checkbox" style="display: none" />
        </div>

        <div class="row">
          <label class="lbl">TTS</label>
          <select id="ttsSel">
            <option>ElevenLabs</option>
            <option>browser</option>
          </select>
          <select id="ttsEngine" style="display: none"></select>

          <input
            id="voiceId"
            class="input"
            placeholder="ElevenLabs voiceId (optional)"
          />

          <div class="spacer"></div>

          <label class="lbl">VAD</label>
          <input id="vadEl" type="range" min="0" max="100" value="35" />
          <input
            id="vad"
            type="range"
            min="0"
            max="100"
            value="35"
            style="display: none"
          />
          <span class="muted">more ← sensitive → less</span>

          <label class="lbl">Silence (ms)</label>
          <input
            id="silenceEl"
            type="number"
            min="200"
            max="4000"
            value="700"
          />
          <input
            id="silence"
            type="number"
            min="200"
            max="4000"
            value="700"
            style="display: none"
          />
        </div>

        <div class="row">
          <label class="lbl">Microphone</label>
          <select id="micSel"></select>
          <select id="microphone" style="display: none"></select>

          <label class="lbl">Output device</label>
          <select id="outSel"></select>
          <select id="output" style="display: none"></select>
        </div>
      </section>

      <section class="io">
        <div class="pane">
          <h3>Transcript</h3>
          <div id="transcript" class="box" aria-live="polite"></div>
          <audio id="lastAudio" controls preload="none"></audio>
        </div>

        <div class="pane">
          <h3>Reply</h3>
          <div id="reply" class="box" aria-live="polite"></div>
          <div class="send-row">
            <input
              id="message"
              class="input grow"
              placeholder="Type and ⌘/Ctrl+Enter to send…"
            />
            <button id="send" class="btn">Send</button>
          </div>
        </div>
      </section>

      <div id="hud" class="hud">
        <div>micRMS: <span id="hudMic">0.000</span></div>
        <div>outRMS: <span id="hudOut">0.000</span></div>
      </div>
    </main>

    <!-- JS (cache-busted). Placed LAST so elements exist before wiring. -->
    <script src="/keilaniStream.js?v=16"></script>
  </body>
</html>
