<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Keilani Chat • Streaming</title>

    <style>
      :root {
        --bg: #0b0f1a;
        --bg2: #0f1422;
        --panel: #101828;
        --text: #d7def2;
        --muted: #8aa0c9;
        --accent: #8b56fc;
        --accent-2: #6ee7ff;
        --ok: #22c55e;
        --chip: #12b7f2;
        --btn: #3f35e8;
        --btnh: #3444d6;
        --border: #22355e;
        --bubble: #121d34;
        --bubble2: #0e1629;
      }
      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        background:
          radial-gradient(1200px 600px at 80% -20%, #0d1b30 0%, #0b0f1a 55%)
            fixed,
          var(--bg);
        color: var(--text);
        font:
          14px/1.45 system-ui,
          -apple-system,
          Segoe UI,
          Roboto,
          Inter,
          sans-serif;
      }
      .toolbar {
        position: sticky;
        top: 0;
        z-index: 5;
        display: flex;
        gap: 0.75rem;
        align-items: center;
        padding: 0.6rem 1rem;
        background: linear-gradient(
          180deg,
          rgba(11, 15, 26, 0.95),
          rgba(11, 15, 26, 0.74) 60%,
          rgba(11, 15, 26, 0) 100%
        );
      }
      .dot {
        width: 8px;
        height: 8px;
        border-radius: 999px;
        background: #18e077;
        box-shadow: 0 0 0 3px #14251a;
      }
      .chip {
        background: var(--chip);
        color: #001;
        padding: 0.25rem 0.55rem;
        border-radius: 999px;
        font-weight: 600;
      }
      select,
      input[type="text"],
      input[type="password"] {
        width: 360px;
        background: var(--panel);
        color: var(--text);
        border: 1px solid var(--border);
        border-radius: 0.6rem;
        padding: 0.55rem 0.8rem;
        outline: none;
      }
      button {
        background: var(--btn);
        color: #fff;
        border: 1px solid var(--border);
        padding: 0.5rem 0.9rem;
        border-radius: 0.6rem;
        cursor: pointer;
      }
      button:hover {
        background: var(--btnh);
      }
      .btn-ghost {
        background: transparent;
      }
      .wrap {
        max-width: 1100px;
        margin: 0 auto;
        padding: 1rem;
      }
      .feed {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
      }
      .msg {
        background: var(--bubble);
        border: 1px solid var(--border);
        border-radius: 0.7rem;
        padding: 0.85rem 1rem;
      }
      .msg.you {
        background: transparent;
        border-color: #273652;
      }
      .meta {
        color: var(--muted);
        font-size: 0.82rem;
        margin: 0.2rem 0 0.1rem;
      }
      .composer {
        margin-top: 1rem;
        border: 1px solid var(--border);
        border-radius: 0.8rem;
        padding: 0.35rem;
        background: var(--bubble2);
      }
      .composer form {
        display: flex;
        gap: 0.6rem;
        align-items: flex-end;
      }
      textarea {
        flex: 1;
        min-height: 58px;
        max-height: 40vh;
        resize: vertical;
        background: transparent;
        color: var(--text);
        border: 0;
        outline: none;
        padding: 0.7rem 0.8rem;
      }
      .hint {
        color: #8aa0c9;
        font-size: 0.8rem;
        margin-top: 0.35rem;
      }
      .row {
        display: flex;
        flex-wrap: wrap;
        gap: 0.6rem;
        align-items: center;
      }
      .stat {
        background: #0f1930;
        border: 1px solid #1c2b4e;
        border-radius: 999px;
        padding: 0.25rem 0.55rem;
        font-size: 0.8rem;
      }
      #avatarDock {
        position: fixed;
        right: 14px;
        bottom: 14px;
        width: 300px;
        max-width: 40vw;
        background: #000;
        border: 1px solid #1e2a45;
        border-radius: 0.6rem;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.45);
        display: none;
      }
      #avatarDock video {
        width: 100%;
        height: auto;
        display: block;
      }
      .bad {
        color: #ffb4b4;
      }
    </style>

    <link rel="stylesheet" href="/vendor/github-dark.min.css" />
  </head>
  <body>
    <div class="toolbar">
      <span class="dot"></span>
      <span class="chip">Streaming</span>
      <label>Model</label>
      <select id="model">
        <option value="gpt-5" selected>gpt-5</option>
        <option value="gpt-4o-mini">gpt-4o-mini</option>
      </select>
      <input id="api" placeholder="https://api.keilani.ai/api/chat" />
      <input id="token" placeholder="Client Token (optional)" />
      <button id="saveBtn" class="btn-ghost">Save</button>
      <button id="exportBtn" class="btn-ghost">Export .txt</button>
      <button id="clearBtn" class="btn-ghost">Clear</button>
      <button id="resetBtn" class="btn-ghost">Reset Session</button>

      <label class="stat"
        ><input id="stream" type="checkbox" checked /> Stream</label
      >
      <label class="stat"
        ><input id="sse" type="checkbox" checked /> Expect SSE</label
      >

      <!-- NEW: voice mode -->
      <label class="stat">
        Voice:
        <select id="voiceMode">
          <option value="off" selected>Off</option>
          <option value="audio">Audio (Browser)</option>
          <option value="avatar">Avatar (D-ID)</option>
        </select>
      </label>

      <span id="tokens" class="stat">Tokens: 0 • 0/s</span>
      <span id="sid" class="stat">SID: —</span>
      <button id="rawBtn" class="btn-ghost">Raw Inspector</button>
    </div>

    <div class="wrap">
      <div id="feed" class="feed"></div>

      <div class="composer">
        <form id="form">
          <textarea id="input" placeholder="Type your message…"></textarea>
          <button id="sendBtn" type="submit">Send ↵</button>
        </form>
        <div class="hint">
          Tip: <b>Enter</b> to send • <b>Shift+Enter</b> for newline
        </div>
      </div>
    </div>

    <!-- Floating avatar/video dock -->
    <div id="avatarDock">
      <video id="avatarVideo" playsinline controls autoplay muted></video>
    </div>

    <script src="/vendor/dayjs.min.js"></script>
    <script src="/vendor/highlight.min.js"></script>
    <script src="/vendor/marked.umd.min.js"></script>
    <script>
      hljs.highlightAll();
    </script>
    <script src="/js/chat.js?v=voice1"></script>
  </body>
</html>
