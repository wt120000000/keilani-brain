<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self';
             img-src 'self' data:;
             media-src 'self' blob:;
             style-src 'self' 'unsafe-inline';
             script-src 'self';
             connect-src 'self' https:;
             frame-ancestors 'self';"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Keilani Chat • Streaming</title>

    <style>
      :root {
        --bg: #0c0f14; --panel:#121622; --panel-2:#0f1320; --border:#1f2a44;
        --text:#e6e8f0; --muted:#9aa4b2; --primary:#7c5cff; --primary-2:#6e50e8;
        --pill:#1b2134; --good:#11c38d; --bad:#ff5370; --shadow:0 10px 30px rgba(0,0,0,.35); --radius:14px;
      }
      *{box-sizing:border-box}
      html,body{height:100%;background:radial-gradient(1200px 700px at 70% -20%,#0b1225 0%,#0b0e18 35%,#0b0e18 100%);color:var(--text);font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Inter,"Helvetica Neue",Arial,"Apple Color Emoji","Segoe UI Emoji")}
      a{color:var(--primary);text-decoration:none}a:hover{text-decoration:underline}
      .wrap{display:grid;grid-template-rows:auto 1fr auto;height:100%;max-width:1100px;margin:0 auto;padding:20px 22px 28px;gap:18px}
      .toolbar{display:grid;grid-template-columns:130px 1fr 260px auto auto auto;gap:10px;align-items:center}
      @media (max-width:980px){.toolbar{grid-template-columns:1fr}}
      .group{display:flex;gap:8px;align-items:center}
      .pill{background:var(--pill);color:var(--muted);border:1px solid var(--border);border-radius:999px;padding:8px 12px;display:inline-flex;gap:8px;align-items:center;white-space:nowrap}
      select,input[type="text"]{background:var(--panel);color:var(--text);border:1px solid var(--border);border-radius:10px;padding:8px 10px;outline:none;width:100%}
      .btn{background:var(--panel);color:var(--text);border:1px solid var(--border);border-radius:12px;padding:8px 12px;cursor:pointer;transition:.15s ease transform,.15s ease background}
      .btn:hover{transform:translateY(-1px);background:var(--panel-2)}
      .btn-primary{background:var(--primary);border-color:#5b46ca}.btn-primary:hover{background:var(--primary-2)}
      .switch{display:inline-flex;gap:10px;align-items:center}.switch input{transform:translateY(1px)}
      .chat{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.0));border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:14px;display:grid;grid-template-rows:1fr auto;min-height:58vh;gap:10px}
      .scroll{overflow:auto;padding:6px 2px}
      .msg{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:12px 14px;margin:10px 0;white-space:pre-wrap;word-break:break-word}
      .msg.user{background:#101529;border-color:#1a2442}.msg.assistant{background:#0f172b;border-color:#1b2542}
      .system{color:var(--muted);font-size:13px}
      .compose{display:grid;grid-template-columns:1fr auto;gap:10px;align-items:end}
      textarea{background:var(--panel);color:var(--text);border:1px solid var(--border);border-radius:12px;padding:12px 14px;min-height:56px;resize:vertical;outline:none}
      code,pre code{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:12.5px}
      pre{background:#0b1222;border:1px solid #1b2a48;border-radius:12px;padding:12px;overflow:auto;margin:8px 0 0}
      .tip{color:var(--muted);font-size:12px;padding:2px 4px 0}.bad{color:var(--bad)}.good{color:var(--good)}
    </style>

    <!-- local vendor assets -->
    <link rel="stylesheet" href="/vendor/github-dark.min.css" />
    <script src="/vendor/dayjs.min.js" defer></script>
    <script src="/vendor/highlight.min.js" defer></script>
    <script src="/vendor/marked.umd.min.js" defer></script>

    <!-- our app code (moved from inline to external to satisfy CSP) -->
    <script src="/js/chat.js" defer></script>
  </head>
  <body>
    <div class="wrap">
      <div class="toolbar">
        <div class="group">
          <div class="pill" title="Connection">
            <div
              style="
                width: 8px;
                height: 8px;
                border-radius: 50%;
                background: #28d27d;
                box-shadow: 0 0 12px #28d27d;
              "
            ></div>
            <strong>Keilani Chat</strong>
            <span class="system">• Streaming</span>
          </div>
        </div>

        <div class="group">
          <select id="model">
            <option value="gpt-5" selected>gpt-5</option>
            <option value="gpt-4.1-mini">gpt-4.1-mini</option>
            <option value="gpt-4o-mini">gpt-4o-mini</option>
          </select>
          <input
            id="api"
            type="text"
            placeholder="https://api.keilani.ai/api/chat"
          />
        </div>

        <input id="token" type="text" placeholder="Client Token (optional)" />

        <div class="group">
          <button id="save" class="btn">Save</button>
          <button id="export" class="btn">Export .txt</button>
          <button id="clear" class="btn">Clear</button>
        </div>

        <div class="group">
          <button id="reset" class="btn">Reset Session</button>
        </div>

        <div class="group">
          <label class="switch"
            ><input id="stream" type="checkbox" checked />
            <span>Stream</span></label
          >
          <label class="switch"
            ><input id="sse" type="checkbox" checked />
            <span>Expect SSE</span></label
          >
        </div>
      </div>

      <div class="group" style="gap: 10px; flex-wrap: wrap">
        <div class="pill">
          Tokens: <span id="tokens">0</span> • <span id="tps">0</span>/s
        </div>
        <div class="pill">SID: <span id="sid">—</span></div>
        <button id="raw" class="btn">Raw Inspector</button>
        <div id="error" class="system bad" hidden></div>
      </div>

      <div class="chat" id="chat">
        <div class="scroll" id="list"></div>
        <div class="compose">
          <textarea
            id="composer"
            placeholder="Type your message…  (Enter to send  •  Shift+Enter for newline)"
          ></textarea>
          <button id="send" class="btn btn-primary">Send ↵</button>
        </div>
        <div class="tip">
          Tip: <b>Ctrl/Cmd+K</b> to focus input • <b>↑</b> to edit last message
        </div>
      </div>
    </div>
  </body>
</html>
