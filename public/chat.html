<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Keilani Chat • Streaming</title>

    <!-- minimal theme (inline ok under your CSP) -->
    <style>
      :root {
        --bg: #0b0f1a;
        --panel: #0f1422;
        --muted: #8aa0c9;
        --text: #dde7f2;
        --chip: #182742;
        --accent: #88c5ff;
        --accent-2: #66e0ff;
        --border: #223c5e;
        --bubble: #0e1629;
        --bubble2: #0e1629;
        --btn: #3578e5;
        --btnh: #2c64bf;
      }
      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        background:
          radial-gradient(1000px 600px at 80% -10%, #0d1b30 0%, #0b0f1a 55%)
            fixed,
          var(--bg);
        color: var(--text);
        font:
          14px/1.5 system-ui,
          -apple-system,
          Segoe UI,
          Roboto,
          Inter,
          sans-serif;
      }
      .toolbar {
        position: sticky;
        top: 0;
        z-index: 5;
        display: flex;
        gap: 0.6rem;
        align-items: center;
        padding: 0.6rem 0.8rem;
        background: linear-gradient(
          180deg,
          rgba(11, 15, 26, 0.96),
          rgba(11, 15, 26, 0.84) 70%,
          rgba(11, 15, 26, 0)
        );
        border-bottom: 1px solid rgba(34, 60, 94, 0.35);
        backdrop-filter: blur(6px);
      }
      .dot {
        width: 9px;
        height: 9px;
        border-radius: 50%;
        background: #15cf82;
        box-shadow: 0 0 0 3px #14251a;
      }
      .chip {
        background: var(--chip);
        color: #a7c1ff;
        padding: 0.35rem 0.6rem;
        border-radius: 999px;
        border: 1px solid rgba(136, 197, 255, 0.25);
      }
      select,
      input[type="text"],
      input[type="password"] {
        background: var(--panel);
        color: var(--text);
        border: 1px solid var(--border);
        border-radius: 0.6rem;
        padding: 0.5rem 0.7rem;
        outline: none;
        min-width: 120px;
      }
      input[type="text"]#api {
        min-width: 360px;
      }
      button {
        background: var(--btn);
        color: #fff;
        border: 1px solid var(--border);
        border-radius: 0.6rem;
        padding: 0.55rem 0.8rem;
        cursor: pointer;
      }
      button:hover {
        background: var(--btnh);
      }
      .btn-ghost {
        background: transparent;
        color: var(--muted);
      }
      .btn-ghost:hover {
        background: #0f1a2e;
      }
      .spacer {
        flex: 1;
      }
      main.container {
        max-width: 1024px;
        margin: 0 auto;
        padding: 1rem;
      }
      .tip {
        color: var(--muted);
        margin: 0.25rem 0 1rem;
        font-size: 0.92rem;
      }
      .feed {
        display: flex;
        flex-direction: column;
        gap: 0.7rem;
      }
      .msg {
        display: flex;
        gap: 0.6rem;
        align-items: flex-start;
      }
      .msg .bubble {
        background: var(--bubble);
        border: 1px solid var(--border);
        border-radius: 0.8rem;
        padding: 0.9rem 0.95rem;
        max-width: 100%;
      }
      .msg.you .bubble {
        background: #0f192a;
      }
      .meta {
        color: var(--muted);
        font-size: 0.8rem;
        margin: 0.25rem 0 0.2rem 0.25rem;
      }
      pre,
      code {
        font-family:
          ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono",
          monospace;
      }
      .composer {
        position: sticky;
        bottom: 0;
        z-index: 4;
        margin-top: 1rem;
        padding: 0.6rem 0.8rem 0.9rem;
        background: linear-gradient(
          180deg,
          rgba(11, 15, 26, 0),
          rgba(11, 15, 26, 0.85) 25%,
          rgba(11, 15, 26, 0.95) 55%
        );
        backdrop-filter: blur(6px);
        border-top: 1px solid rgba(34, 60, 94, 0.35);
      }
      .composer .row {
        display: flex;
        gap: 0.6rem;
        align-items: flex-end;
        background: var(--bubble);
        border: 1px solid var(--border);
        border-radius: 0.8rem;
        padding: 0.35rem;
      }
      textarea {
        flex: 1;
        resize: vertical;
        min-height: 46px;
        max-height: 220px;
        background: transparent;
        border: 0;
        outline: 0;
        color: var(--text);
        padding: 0.6rem 0.7rem;
        font: inherit;
        line-height: 1.4;
      }
      .right {
        display: flex;
        gap: 0.5rem;
        align-items: center;
        padding: 0.25rem;
      }
      .row2 {
        display: flex;
        gap: 0.6rem;
        align-items: center;
        justify-content: space-between;
        margin-top: 0.4rem;
      }
      .pill {
        background: rgba(21, 207, 130, 0.08);
        border: 1px solid rgba(21, 207, 130, 0.25);
        color: #7fe7c4;
        padding: 0.25rem 0.45rem;
        border-radius: 0.7rem;
        font-size: 0.8rem;
      }
      .kbd {
        border: 1px solid #334867;
        color: #a8c4ff;
        background: #0f1626;
        padding: 0.1rem 0.35rem;
        border-radius: 0.35rem;
        font-size: 0.8rem;
      }
      .hide {
        display: none;
      }
    </style>

    <!-- syntax highlight theme -->
    <link rel="stylesheet" href="/vendor/github-dark.min.css" />
  </head>
  <body>
    <!-- ===== Toolbar / Controls ===== -->
    <div class="toolbar">
      <span class="dot" title="online"></span>
      <span class="chip">Keilani Chat</span>
      <span class="chip">Streaming</span>

      <select id="model" title="Model">
        <option value="gpt-5" selected>gpt-5</option>
        <option value="gpt-4.1-mini">gpt-4.1-mini</option>
        <option value="o4-mini">o4-mini</option>
      </select>

      <input
        id="api"
        type="text"
        placeholder="https://api.keilani.ai/api/chat"
      />
      <input id="token" type="password" placeholder="Client Token (optional)" />

      <button id="save" title="Save prefs">Save</button>
      <button id="export" class="btn-ghost" title="Export .txt">
        Export .txt
      </button>
      <button id="clear" class="btn-ghost" title="Clear conversation">
        Clear
      </button>
      <button id="reset" class="btn-ghost" title="New session">
        Reset Session
      </button>

      <span class="spacer"></span>

      <label class="chip" title="Stream chunks">
        <input id="stream" type="checkbox" checked /> Stream
      </label>
      <label class="chip" title="Expect SSE (EventSource)">
        <input id="expectSSE" type="checkbox" checked /> Expect SSE
      </label>

      <span id="tokens" class="chip" title="Token meter">Tokens: 0 • 0/s</span>
      <span id="sid" class="chip" title="Session id">SID: —</span>
      <button id="raw" class="btn-ghost" title="Raw inspector">
        Raw Inspector
      </button>
    </div>

    <main class="container">
      <div class="tip">
        Tip: <b>Enter</b> to send • <b>Shift+Enter</b> for newline
      </div>

      <!-- ===== FEED (chat bubbles get appended here) ===== -->
      <main
        id="feed"
        class="feed"
        aria-live="polite"
        aria-label="Conversation"
      ></main>

      <!-- ===== Composer ===== -->
      <section class="composer" aria-label="Composer">
        <div class="row">
          <textarea id="composer" placeholder="Type your message…"></textarea>
          <div class="right">
            <button id="send" title="Send (Enter)">Send ↵</button>
          </div>
        </div>

        <div class="row2">
          <div class="tip">
            Press <span class="kbd">Enter</span> to send •
            <span class="kbd">Shift+Enter</span> for newline
          </div>
          <div class="pill" id="statusPill" aria-live="polite"></div>
        </div>
      </section>
    </main>

    <!-- ===== Vendor libs (local) ===== -->
    <script src="/vendor/dayjs.min.js"></script>
    <script src="/vendor/highlight.min.js"></script>
    <script src="/vendor/marked.umd.min.js"></script>

    <!-- ===== App JS ===== -->
    <script src="/js/chat.js?v=4"></script>
  </body>
</html>
