<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Keilani Engage</title>

  <!-- Favicons / PWA -->
  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="manifest" href="/site.webmanifest">
  <meta name="theme-color" content="#000000">

  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <div id="app">
    <div class="header">
      <img src="/favicon-32x32.png" alt="Keilani" />
      <h1>Keilani Engage</h1>
    </div>

    <div class="card" id="status">
      <div><strong>Status:</strong> Page loaded. Bridge ready.</div>
      <div class="small">
        Tip: add <code>?mock=1</code> to the URL to simulate speech without D‑ID.
      </div>
    </div>

    <div id="ui"></div>
  </div>

  <!-- your bridge code -->
  <script src="/brain-bridge.js"></script>

  <!-- Mock session (opt-in via ?mock=1) -->
  <script>
    (function () {
      const params = new URLSearchParams(location.search);
      if (params.get('mock') !== '1') return;            // only run in mock mode
      if (window.__bridgeMockLoaded) return;             // guard against duplicates
      window.__bridgeMockLoaded = true;

      // Simple mock that mimics your D‑ID session API surface
      const mock = window.mockSession = window.mockSession || {
        speak: async ({ text }) => {
          console.log("[mockSession.speak]", text);
          const s = document.getElementById("status");
          if (s) s.innerHTML = "<strong>Status:</strong> Speaking: " + text;
          await new Promise(r => setTimeout(r, Math.min(1500, 200 + text.length * 20)));
          if (s) s.innerHTML = "<strong>Status:</strong> idle";
        },
        stopSpeaking: async () => console.log("[mockSession.stopSpeaking]"),
        _handlers: {},
        on(event, handler) {
          (this._handlers[event] ||= []).push(handler);
          console.log("[mockSession.on]", event);
        },
        emit(event, payload) {
          (this._handlers[event] || []).forEach(h => h(payload));
        }
      };

      // Initialize bridge with status hook
      initBrainBridge(mock, {
        onStatus: (s) => {
          const el = document.getElementById("status");
          if (el) el.innerHTML = "<strong>Status:</strong> " + s;
        }
      });

      // Click anywhere to simulate a user utterance → final transcript
      document.addEventListener("click", () => {
        mock.emit("vad-start");
        setTimeout(() => mock.emit("transcript", { isFinal: true, text: "Hey Keilani, say hi!" }), 600);
      });
    })();
  </script>

  <!-- Example: when you have a real D‑ID session object, call:
  <script>
    // after you create/connect the D‑ID session:  const session = ...
    initBrainBridge(session, {
      onStatus: (s) => { document.getElementById('status').innerHTML = "<strong>Status:</strong> " + s; },
      // events: { transcript: 'speech', userStartTalking: 'voice-activity-start', connected: 'connected', error: 'error' }
    });
  </script>
  -->
</body>
</html>
