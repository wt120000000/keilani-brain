<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Keilani Engage</title>

  <!-- Favicons / PWA -->
  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="manifest" href="/site.webmanifest">
  <meta name="theme-color" content="#000000">

  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <div id="app">
    <div class="header">
      <img src="/favicon-32x32.png" alt="Keilani" />
      <h1>Keilani Engage</h1>
    </div>

    <div class="card" id="status">
      <div><strong>Status:</strong> Loading…</div>
      <div class="small">Open DevTools → Console for logs.</div>
    </div>

    <div id="ui"></div>
  </div>

  <script src="/brain-bridge.js"></script>
  <script>
  // --- MOCK SESSION FOR SMOKE-TESTING ONLY ---
  // It pretends to be your D‑ID session so we can prove the bridge works.
  const mockSession = {
    // bridge will call this to speak; we just log it for now
    speak: async ({ text }) => {
      console.log("[mockSession.speak]", text);
      const s = document.getElementById("status");
      if (s) s.innerHTML = "<strong>Status:</strong> Speaking: " + text;
      await new Promise(r => setTimeout(r, Math.min(1500, 200 + text.length * 20)));
      if (s) s.innerHTML = "<strong>Status:</strong> idle";
    },
    stopSpeaking: async () => console.log("[mockSession.stopSpeaking]"),

    // a minimal event bus so we can fire fake transcript events
    _handlers: {},
    on(event, handler) {
      (this._handlers[event] ||= []).push(handler);
      console.log("[mockSession.on]", event);
    },
    emit(event, payload) {
      (this._handlers[event] || []).forEach(h => h(payload));
    }
  };

  // Initialize the bridge
  const bridge = initBrainBridge(mockSession, {
    onStatus: (s) => {
      const el = document.getElementById("status");
      if (el) el.innerHTML = "<strong>Status:</strong> " + s;
    }
  });

  // Demo: simulate user speech → final transcript → brain reply
  // Click anywhere to trigger a fake final transcript
  document.addEventListener("click", () => {
    console.log("[mock] user starts talking");
    mockSession.emit("vad-start");
    // after a beat, emit a FINAL transcript event with some text
    setTimeout(() => {
      console.log("[mock] final transcript emitted");
      mockSession.emit("transcript", { isFinal: true, text: "Hey Keilani, say hi!" });
    }, 600);
  });
</script>

  <script>
    // simple “it loaded” indicator
    (function () {
      const s = document.getElementById('status');
      if (s) s.innerHTML = "<strong>Status:</strong> Page loaded. Bridge ready.";
      console.log("[Engage] page loaded");
    })();
  </script>
  
  <script>
  // fake session that just logs instead of talking
  const mockSession = {
    speak: async ({ text }) => console.log("[mockSession.speak]", text),
    stopSpeaking: async () => console.log("[mockSession.stopSpeaking]"),
    on: (event, handler) => console.log("[mockSession.on]", event),
  };

  // initialize with simple status hook
  initBrainBridge(mockSession, {
    onStatus: (s) => { document.getElementById("status").textContent = "Status: " + s; }
  });
</script>

</body>
</html>
